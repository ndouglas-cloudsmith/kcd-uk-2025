apiVersion: apps/v1
kind: Deployment
metadata:
  name: insecure-worker
  namespace: google
spec:
  replicas: 1
  selector:
    matchLabels:
      app: insecure-worker
  template:
    metadata:
      labels:
        app: insecure-worker
    spec:
      # --- MISCONFIGURATIONS (POD) ---
      hostPID: true
      
      volumes:
      # (High) Points to the host's root filesystem
      - name: host-root-fs
        hostPath:
          path: / 
          
      # --- NEW CRITICAL MISCONFIGURATION ---
      # Points to the container daemon socket
      - name: docker-sock
        hostPath:
          # This path may be different for other runtimes, 
          # e.g., /run/containerd/containerd.sock
          path: /var/run/docker.sock 
      # -------------------------------------

      containers:
      - name: main
        image: busybox:1.36
        command: [ "sleep", "3600" ]
        env:
        - name: SLACK_BOT_TOKEN
          value: "xoxb-1234567890-0987654321-aBcDeFgHiJkLmNoPqRs"
        - name: INTERNAL_API_KEY
          value: "sk_live_1234567890abcdefghijklmnopqrstuv"
        
        volumeMounts:
        # (High) Mounts the host root
        - name: host-root-fs
          mountPath: /host-root
          
        # --- NEW CRITICAL MISCONFIGURATION ---
        # Mounts the Docker socket, allowing container breakout
        - name: docker-sock
          mountPath: /var/run/docker.sock
        # -------------------------------------
          
        securityContext:
          # (High) Gives the container root access to the host
          privileged: true
          
          # (High) Allows the container to escalate privileges
          allowPrivilegeEscalation: true
          
          # (High) Explicitly running as the root user
          runAsUser: 0
          
          capabilities:
            add:
            - "NET_RAW"
            # --- NEW CRITICAL MISCONFIGURATION ---
            # Adds the most powerful Linux capability
            - "SYS_ADMIN" 
            # -------------------------------------
